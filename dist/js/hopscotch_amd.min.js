/**! hopscotch - v0.3.2
*
* Copyright 2017 LinkedIn Corp. All rights reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
define(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n="bubble_default",o=window.Sizzle||null,p="undefined",q=!1,r=("undefined"==typeof jQuery?"undefined":m(jQuery))!==p,s=!1,t=!1,u=/^[a-zA-Z]+[a-zA-Z0-9_-]*$/,v={left:"right",right:"left"};try{m(window.sessionStorage)!==p&&(s=!0,sessionStorage.setItem("hopscotch.test.storage","ok"),sessionStorage.removeItem("hopscotch.test.storage"),t=!0)}catch(w){}k={smoothScroll:!0,scrollDuration:1e3,scrollTopMargin:200,scrollLeftMargin:200,showCloseButton:!0,showPrevButton:!1,showNextButton:!0,bubbleWidth:280,bubblePadding:15,arrowWidth:20,skipIfNoElement:!0,isRtl:!1,cookieName:"hopscotch.tour.state"},Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),j=function(){q&&l.startTour()},g={addClass:function(a,b){var c,d,e,f;if(a.className){for(d=b.split(/\s+/),c=" "+a.className+" ",e=0,f=d.length;f>e;++e)c.indexOf(" "+d[e]+" ")<0&&(c+=d[e]+" ");a.className=c.replace(/^\s+|\s+$/g,"")}else a.className=b},removeClass:function(a,b){var c,d,e,f;for(d=b.split(/\s+/),c=" "+a.className+" ",e=0,f=d.length;f>e;++e)c=c.replace(" "+d[e]+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")},hasClass:function(a,b){var c;return a.className?(c=" "+a.className+" ",-1!==c.indexOf(" "+b+" ")):!1},getPixelValue:function(a){var b="undefined"==typeof a?"undefined":m(a);return"number"===b?a:"string"===b?parseInt(a,10):0},valOrDefault:function(a,b){return("undefined"==typeof a?"undefined":m(a))!==p?a:b},invokeCallbackArrayHelper:function(a){var b;return Array.isArray(a)&&(b=i[a[0]],"function"==typeof b)?b.apply(this,a.slice(1)):void 0},invokeCallbackArray:function(a){var b,c;if(Array.isArray(a)){if("string"==typeof a[0])return g.invokeCallbackArrayHelper(a);for(b=0,c=a.length;c>b;++b)g.invokeCallback(a[b])}},invokeCallback:function(a){return"function"==typeof a?a():"string"==typeof a&&i[a]?i[a]():g.invokeCallbackArray(a)},invokeEventCallbacks:function(a,b){var c,d,e=h[a];if(b)return this.invokeCallback(b);for(c=0,d=e.length;d>c;++c)this.invokeCallback(e[c].cb)},getScrollTop:function(){var a;return a=m(window.pageYOffset)!==p?window.pageYOffset:document.documentElement.scrollTop},getScrollLeft:function(){var a;return a=m(window.pageXOffset)!==p?window.pageXOffset:document.documentElement.scrollLeft},getWindowHeight:function(){return window.innerHeight||document.documentElement.clientHeight},getWindowWidth:function(){return window.innerWidth||document.documentElement.clientWidth},addEvtListener:function(a,b,c){return a?a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c):void 0},removeEvtListener:function(a,b,c){return a?a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c):void 0},documentIsReady:function(){return"complete"===document.readyState},evtPreventDefault:function(a){a.preventDefault?a.preventDefault():event&&(event.returnValue=!1)},extend:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},getStepTargetHelper:function(a){var b=document.getElementById(a);if(b)return b;if(r)return b=jQuery(a),b.length?b[0]:null;if(o)return b=new o(a),b.length?b[0]:null;if(document.querySelector)try{return document.querySelector(a)}catch(c){}return/^#[a-zA-Z][\w-_:.]*$/.test(a)?document.getElementById(a.substring(1)):null},getStepTarget:function(a){var b;if(!a||!a.target)return null;if("string"==typeof a.target)return g.getStepTargetHelper(a.target);if(Array.isArray(a.target)){var c,d;for(c=0,d=a.target.length;d>c;c++)if("string"==typeof a.target[c]&&(b=g.getStepTargetHelper(a.target[c])))return b;return null}return a.target},getI18NString:function(a){return e[a]||d[a]},setState:function(a,b,c){var d,e="";if(s&&t)try{sessionStorage.setItem(a,b)}catch(f){t=!1,this.setState(a,b,c)}else s&&sessionStorage.removeItem(a),c&&(d=new Date,d.setTime(d.getTime()+24*c*60*60*1e3),e="; expires="+d.toGMTString()),document.cookie=a+"="+b+e+"; path=/"},getState:function(a){var b,c,d,e=a+"=",f=document.cookie.split(";");if(s&&(d=sessionStorage.getItem(a)))return d;for(b=0;b<f.length;b++){for(c=f[b];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(e)){d=c.substring(e.length,c.length);break}}return d},clearState:function(a){s?sessionStorage.removeItem(a):this.setState(a,"",-1)},normalizePlacement:function(a){!a.placement&&a.orientation&&(a.placement=a.orientation)},flipPlacement:function(a){if(a.isRtl&&!a._isFlipped){var b,c,d=["orientation","placement"];a.xOffset&&(a.xOffset=-1*this.getPixelValue(a.xOffset));for(c in d)b=d[c],a.hasOwnProperty(b)&&v.hasOwnProperty(a[b])&&(a[b]=v[a[b]]);a._isFlipped=!0}}},g.addEvtListener(window,"load",j),h={next:[],prev:[],start:[],end:[],show:[],error:[],close:[]},i={},d={stepNums:null,nextBtn:"Next",prevBtn:"Back",doneBtn:"Done",skipBtn:"Skip",closeTooltip:"Close"},e={},b=function(a){this.init(a)},b.prototype={isShowing:!1,currStep:void 0,setPosition:function(a){var b,c,d,e,f,h,i,j=g.getStepTarget(a),k=this.element,l=this.arrowEl,m=a.isRtl?"right":"left";if(a.bubbleInCenter)return void this.setWindowCenterPosition(a);if(g.flipPlacement(a),g.normalizePlacement(a),c=k.offsetWidth,b=k.offsetHeight,g.removeClass(k,"fade-in-down fade-in-up fade-in-left fade-in-right fade-in-left-pct fade-in-right-pct windowCenter"),g.removeClass(l,"hide"),d=j.getBoundingClientRect(),i=a.isRtl?d.right-c:d.left,"top"===a.placement)e=d.top-b-this.opt.arrowWidth,f=i;else if("bottom"===a.placement)e=d.bottom+this.opt.arrowWidth,f=i;else if("left"===a.placement)e=d.top,f=d.left-c-this.opt.arrowWidth;else{if("right"!==a.placement)throw new Error("Bubble placement failed because step.placement is invalid or undefined!");e=d.top,f=d.right+this.opt.arrowWidth}h="center"!==a.arrowOffset?g.getPixelValue(a.arrowOffset):a.arrowOffset,h?"top"===a.placement||"bottom"===a.placement?(l.style.top="","center"===h?l.style[m]=Math.floor(c/2-l.offsetWidth/2)+"px":l.style[m]=h+"px"):("left"===a.placement||"right"===a.placement)&&(l.style[m]="","center"===h?l.style.top=Math.floor(b/2-l.offsetHeight/2)+"px":l.style.top=h+"px"):(l.style.top="",l.style[m]=""),"center"===a.xOffset?f=d.left+j.offsetWidth/2-c/2:f+=g.getPixelValue(a.xOffset),"center"===a.yOffset?e=d.top+j.offsetHeight/2-b/2:e+=g.getPixelValue(a.yOffset),a.fixedElement||(e+=g.getScrollTop(),f+=g.getScrollLeft()),k.style.position=a.fixedElement?"fixed":"absolute",k.style.top=e+"px",k.style.left=f+"px"},setWindowCenterPosition:function(a){var b=this.element,c=this.arrowEl;g.flipPlacement(a),g.normalizePlacement(a),g.removeClass(b,"fade-in-down fade-in-up fade-in-left fade-in-right fade-in-left-pct fade-in-right-pct windowCenter"),g.addClass(b,"windowCenter"),g.addClass(c,"hide")},render:function(a,b,c){var d,e,h,i,j,k,m,o,p,q,r=this.element;if(a?this.currStep=a:this.currStep&&(a=this.currStep),this.opt.isTourBubble?(i=l.getCurrTour(),i&&(e=i.customData,d=i.customRenderer,a.isRtl=a.hasOwnProperty("isRtl")?a.isRtl:i.hasOwnProperty("isRtl")?i.isRtl:this.opt.isRtl,h=i.unsafe,Array.isArray(i.steps)&&(j=i.steps.length,k=this._getStepI18nNum(this._getStepNum(j-1)),o=this._getStepNum(b)===this._getStepNum(j-1)))):(e=a.customData,d=a.customRenderer,h=a.unsafe,a.isRtl=a.hasOwnProperty("isRtl")?a.isRtl:this.opt.isRtl),m=o?g.getI18NString("doneBtn"):a.showSkip?g.getI18NString("skipBtn"):g.getI18NString("nextBtn"),g.flipPlacement(a),g.normalizePlacement(a),this.placement=a.placement,q={i18n:{prevBtn:g.getI18NString("prevBtn"),nextBtn:m,closeTooltip:g.getI18NString("closeTooltip"),stepNum:this._getStepI18nNum(this._getStepNum(b)),numSteps:k},buttons:{showPrev:g.valOrDefault(a.showPrevButton,this.opt.showPrevButton)&&this._getStepNum(b)>0,showNext:g.valOrDefault(a.showNextButton,this.opt.showNextButton),showCTA:g.valOrDefault(a.showCTAButton&&a.ctaLabel,!1),ctaLabel:a.ctaLabel,showClose:g.valOrDefault(this.opt.showCloseButton,!0)},step:{num:b,isLast:g.valOrDefault(o,!1),title:a.title||"",content:a.content||"",isRtl:a.isRtl,placement:a.placement,padding:g.valOrDefault(a.padding,this.opt.bubblePadding),width:g.getPixelValue(a.width)||this.opt.bubbleWidth,customData:a.customData||{}},tour:{isTour:this.opt.isTourBubble,numSteps:j,unsafe:g.valOrDefault(h,!1),customData:e||{}}},"function"==typeof d)r.innerHTML=d(q);else if("string"==typeof d){if(!l.templates||"function"!=typeof l.templates[d])throw new Error('Bubble rendering failed - template "'+d+'" is not a function.');r.innerHTML=l.templates[d](q)}else if(f)r.innerHTML=f(q);else{if(!l.templates||"function"!=typeof l.templates[n])throw new Error('Bubble rendering failed - template "'+n+'" is not a function.');r.innerHTML=l.templates[n](q)}var s,t=r.children,u=t.length;for(p=0;u>p;p++)s=t[p],g.hasClass(s,"hopscotch-arrow")&&(this.arrowEl=s);return r.style.zIndex="number"==typeof a.zindex?a.zindex:"",this._setArrow(a.placement),this.hide(!1),this.setPosition(a),c&&c(!a.fixedElement),this},_getStepNum:function(a){var b,c,d=0,e=l.getSkippedStepsIndexes(),f=e.length;for(c=0;f>c;c++)b=e[c],a>b&&d++;return a-d},_getStepI18nNum:function(a){var b=g.getI18NString("stepNums");return b&&a<b.length?a=b[a]:a+=1,a},_setArrow:function(a){g.removeClass(this.arrowEl,"down up right left"),"top"===a?g.addClass(this.arrowEl,"down"):"bottom"===a?g.addClass(this.arrowEl,"up"):"left"===a?g.addClass(this.arrowEl,"right"):"right"===a&&g.addClass(this.arrowEl,"left")},_getArrowDirection:function(){return"top"===this.placement?"down":"bottom"===this.placement?"up":"left"===this.placement?"right":"right"===this.placement?"left":void 0},show:function(){var a=this,b="fade-in-"+this._getArrowDirection(),c=1e3;return g.hasClass(this.element,"windowCenter")&&(b+="-pct"),g.removeClass(this.element,"hide"),g.addClass(this.element,b),setTimeout(function(){g.removeClass(a.element,"invisible")},50),setTimeout(function(){g.removeClass(a.element,b)},c),this.isShowing=!0,this},hide:function(a){var b=this.element;return a=g.valOrDefault(a,!0),b.style.top="",b.style.left="",a?(g.addClass(b,"hide"),g.removeClass(b,"invisible")):(g.removeClass(b,"hide"),g.addClass(b,"invisible")),g.removeClass(b,"animate fade-in-up fade-in-down fade-in-right fade-in-left"),this.isShowing=!1,this},destroy:function(){var a=this.element;a&&a.parentNode.removeChild(a),g.removeEvtListener(a,"click",this.clickCb)},_handleBubbleClick:function(a){function b(c){return c===a.currentTarget?null:g.hasClass(c,"hopscotch-cta")?"cta":g.hasClass(c,"hopscotch-next")?"next":g.hasClass(c,"hopscotch-prev")?"prev":g.hasClass(c,"hopscotch-close")?"close":b(c.parentElement)}var c;a=a||window.event;var d=a.target||a.srcElement;if(c=b(d),"cta"===c)this.opt.isTourBubble||l.getCalloutManager().removeCallout(this.currStep.id),this.currStep.onCTA&&g.invokeCallback(this.currStep.onCTA);else if("next"===c)l.nextStep(!0);else if("prev"===c)l.prevStep(!0);else if("close"===c){if(this.opt.isTourBubble){var e=l.getCurrStepNum(),f=l.getCurrTour(),h=e===f.steps.length-1;g.invokeEventCallbacks("close"),l.endTour(!0,h)}else this.opt.onClose&&g.invokeCallback(this.opt.onClose),this.opt.id&&!this.opt.isTourBubble?l.getCalloutManager().removeCallout(this.opt.id):this.destroy();g.evtPreventDefault(a)}},init:function(a){var b,c,d,e,f=document.createElement("div"),h=this,i=!1;this.element=f,e={showPrevButton:k.showPrevButton,showNextButton:k.showNextButton,bubbleWidth:k.bubbleWidth,bubblePadding:k.bubblePadding,arrowWidth:k.arrowWidth,isRtl:k.isRtl,showNumber:!0,isTourBubble:!0},a=("undefined"==typeof a?"undefined":m(a))===p?{}:a,g.extend(e,a),this.opt=e,f.className="hopscotch-bubble animated",e.isTourBubble?(d=l.getCurrTour(),d&&g.addClass(f,"tour-"+d.id)):g.addClass(f,"hopscotch-callout no-number"),b=function(){!i&&h.isShowing&&(i=!0,setTimeout(function(){h.setPosition(h.currStep),i=!1},100))},g.addEvtListener(window,"resize",b),this.clickCb=function(a){h._handleBubbleClick(a)},g.addEvtListener(f,"click",this.clickCb),this.hide(),g.documentIsReady()?document.body.appendChild(f):(document.addEventListener?(c=function(){document.removeEventListener("DOMContentLoaded",c),window.removeEventListener("load",c),document.body.appendChild(f)},document.addEventListener("DOMContentLoaded",c,!1)):(c=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",c),window.detachEvent("onload",c),document.body.appendChild(f))},document.attachEvent("onreadystatechange",c)),g.addEvtListener(window,"load",c))}},c=function(){var a={},c={};this.createCallout=function(d){var e;if(!d.id)throw new Error("Must specify a callout id.");if(!u.test(d.id))throw new Error("Callout ID is using an invalid format. Use alphanumeric, underscores, and/or hyphens only. First character must be a letter.");if(a[d.id])throw new Error("Callout by that id already exists. Please choose a unique id.");if(!g.getStepTarget(d))throw new Error("Must specify existing target element via 'target' option.");return d.showNextButton=d.showPrevButton=!1,d.isTourBubble=!1,e=new b(d),a[d.id]=e,c[d.id]=d,e.render(d,null,function(){e.show(),d.onShow&&g.invokeCallback(d.onShow)}),e},this.getCallout=function(b){return a[b]},this.removeAllCallouts=function(){var b;for(b in a)a.hasOwnProperty(b)&&this.removeCallout(b)},this.removeCallout=function(b){var d=a[b];a[b]=null,c[b]=null,d&&d.destroy()},this.refreshCalloutPositions=function(){var b,d,e;for(b in a)a.hasOwnProperty(b)&&c.hasOwnProperty(b)&&(d=a[b],e=c[b],d&&e&&d.setPosition(e))}},a=function(a){var d,j,o,s,t,v,w,x,y=this,z={},A=[],B=function(a){return d&&d.element&&d.element.parentNode||(d=new b(o)),a&&g.extend(d.opt,{bubblePadding:D("bubblePadding"),bubbleWidth:D("bubbleWidth"),showNextButton:D("showNextButton"),showPrevButton:D("showPrevButton"),showCloseButton:D("showCloseButton"),arrowWidth:D("arrowWidth"),isRtl:D("isRtl")}),d},C=function(){d&&(d.destroy(),d=null)},D=function(a){return"undefined"==typeof o?k[a]:g.valOrDefault(o[a],k[a])},E=function(){var a;return a=!s||0>t||t>=s.steps.length?null:s.steps[t]},F=function(){y.nextStep()},G=function(a){var b,c,d,e,f,h,i,j,k=B(),l=k.element,n=g.getPixelValue(l.style.top),o=n+g.getPixelValue(l.offsetHeight),q=g.getPixelValue(l.style.left),s=q+g.getPixelValue(l.offsetWidth),t=g.getStepTarget(E()),u=t.getBoundingClientRect(),v=u.top+g.getScrollTop(),w=u.bottom+g.getScrollTop(),x=u.left+g.getScrollLeft(),y=u.right+g.getScrollLeft(),z=v>n?n:v,A=x>q?q:x,C=o>w?o:w,F=s>y?s:y,G=g.getScrollTop(),H=G+g.getWindowHeight(),I=g.getScrollLeft(),J=I+g.getWindowWidth(),K=A-D("scrollLeftMargin"),L=z-D("scrollTopMargin");if(z>=G&&(z<=G+D("scrollTopMargin")||H>=C)&&A>=I&&(A<=I+D("scrollLeftMargin")||J>=F))a&&a();else if(g.hasClass(l,"windowCenter"))a&&a();else if(D("smoothScroll"))if(("undefined"==typeof YAHOO?"undefined":m(YAHOO))!==p&&m(YAHOO.env)!==p&&m(YAHOO.env.ua)!==p&&m(YAHOO.util)!==p&&m(YAHOO.util.Scroll)!==p)b=YAHOO.env.ua.webkit?document.body:document.documentElement,d=YAHOO.util.Easing?YAHOO.util.Easing.easeOut:void 0,c=new YAHOO.util.Scroll(b,{scroll:{to:[K,L]}},D("scrollDuration")/1e3,d),c.onComplete.subscribe(a),c.animate();else if(r)jQuery("body, html").animate({scrollTop:L,scrollLeft:K},D("scrollDuration"),a);else if(d3){var M=function(a,b){return function(){var c=d3.interpolateNumber(window.pageXOffset||document.documentElement.scrollLeft,a),d=d3.interpolateNumber(window.pageYOffset||document.documentElement.scrollTop,b);return function(a){scrollTo(c(a),d(a))}}},N=D("scrollDuration");d3.transition().duration(N).tween("scroll",M(K,L)).each("end",function(){a&&a()})}else 0>K&&(K=0),0>L&&(L=0),e=I>A?-1:1,f=G>z?-1:1,h=Math.abs(I-K)/(D("scrollDuration")/10),i=Math.abs(G-L)/(D("scrollDuration")/10),(j=function(){var b=g.getScrollTop(),c=g.getScrollLeft(),d=!0,k=!0,l=c+e*h,m=b+f*i;return(e>0&&l>=K||0>e&&K>=l)&&(l=K,d=!1),(f>0&&m>=L||0>f&&L>=m)&&(m=L,k=!1),d||k?(window.scrollTo(l,m),g.getScrollTop()===b&&g.getScrollLeft()===c?void(a&&a()):void setTimeout(j,10)):(a&&a(),void window.scrollTo(l,m))})();else window.scrollTo(K,L),a&&a()},H=function O(a,b){var c,d,e;t+a>=0&&t+a<s.steps.length?(t+=a,d=E(),e=function(){c=g.getStepTarget(d),c?(z[t]&&delete z[t],b(t)):(z[t]=!0,g.invokeEventCallbacks("error"),O(a,b))},d.delay?setTimeout(e,d.delay):e()):b(-1)},I=function(a,b){var c,d,e,f,h=B(),i=this;if(h.hide(),a=g.valOrDefault(a,!0),c=E(),c.nextOnTargetClick&&g.removeEvtListener(g.getStepTarget(c),"click",F),d=c,e=b>0?d.multipage:t>0&&s.steps[t-1].multipage,f=function(c){var f;if(-1===c)return this.endTour(!0);if(a&&(f=b>0?g.invokeEventCallbacks("next",d.onNext):g.invokeEventCallbacks("prev",d.onPrev)),c===t){if(e)return void M();f=g.valOrDefault(f,!0),f?this.showStep(c):this.endTour(!1)}},!e&&D("skipIfNoElement"))H(b,function(a){f.call(i,a)});else if(t+b>=0&&t+b<s.steps.length){if(t+=b,c=E(),!g.getStepTarget(c)&&!e)return g.invokeEventCallbacks("error"),this.endTour(!0,!1);f.call(this,t)}else if(t+b===s.steps.length)return this.endTour();return this},J=function(a){var b,c,d,e={};for(b in a)a.hasOwnProperty(b)&&"id"!==b&&"steps"!==b&&(e[b]=a[b]);return x.call(this,e,!0),c=g.getState(D("cookieName")),c&&(d=c.split(":"),v=d[0],w=d[1],d.length>2&&(A=d[2].split(",")),w=parseInt(w,10)),this},K=function(a,b,c){var d,e;if(t=a||0,z=b||{},d=E(),e=g.getStepTarget(d))return void c(t);if(!e){if(g.invokeEventCallbacks("error"),z[t]=!0,D("skipIfNoElement"))return void H(1,c);t=-1,c(t)}},L=function(a){function b(){d.show(),g.invokeEventCallbacks("show",c.onShow)}var c=s.steps[a],d=B(),e=g.getStepTarget(c);t!==a&&E().nextOnTargetClick&&g.removeEvtListener(g.getStepTarget(E()),"click",F),t=a,d.hide(!1),d.render(c,a,function(a){a?G(b):b(),c.nextOnTargetClick&&g.addEvtListener(e,"click",F)}),M()},M=function(){var a=s.id+":"+t,b=l.getSkippedStepsIndexes();b&&b.length>0&&(a+=":"+b.join(",")),g.setState(D("cookieName"),a,1)},N=function(a){a&&this.configure(a)};this.getCalloutManager=function(){return("undefined"==typeof j?"undefined":m(j))===p&&(j=new c),j},this.startTour=function(a,b){var c,d,e={},f=this;if(!s){if(!a)throw new Error("Tour data is required for startTour.");if(!a.id||!u.test(a.id))throw new Error("Tour ID is using an invalid format. Use alphanumeric, underscores, and/or hyphens only. First character must be a letter.");s=a,J.call(this,a)}if(("undefined"==typeof b?"undefined":m(b))!==p){if(b>=s.steps.length)throw new Error("Specified step number out of bounds.");d=b}if(!g.documentIsReady())return q=!0,this;if("undefined"==typeof d&&s.id===v&&("undefined"==typeof w?"undefined":m(w))!==p){if(d=w,A.length>0)for(var h=0,i=A.length;i>h;h++)e[A[h]]=!0}else d||(d=0);return K(d,e,function(a){var b=-1!==a&&g.getStepTarget(s.steps[a]);return b?(g.invokeEventCallbacks("start"),c=B(),c.hide(!1),f.isActive=!0,void(g.getStepTarget(E())?f.showStep(a):(g.invokeEventCallbacks("error"),D("skipIfNoElement")&&f.nextStep(!1)))):(g.invokeEventCallbacks("error"),void f.endTour(!1,!1))}),this},this.showStep=function(a){var b=s.steps[a],c=t;return g.getStepTarget(b)?(b.delay?setTimeout(function(){L(a)},b.delay):L(a),this):(t=a,g.invokeEventCallbacks("error"),void(t=c))},this.prevStep=function(a){return I.call(this,a,-1),this},this.nextStep=function(a){return I.call(this,a,1),this},this.endTour=function(a,b){var c,d=B();return a=g.valOrDefault(a,!0),b=g.valOrDefault(b,!0),s&&(c=E(),c&&c.nextOnTargetClick&&g.removeEvtListener(g.getStepTarget(c),"click",F)),t=0,w=void 0,d.hide(),a&&g.clearState(D("cookieName")),this.isActive&&(this.isActive=!1,s&&b&&g.invokeEventCallbacks("end")),this.removeCallbacks(null,!0),this.resetDefaultOptions(),C(),s=null,this},this.clearState=function(){g.clearState(D("cookieName"))},this.getCurrTour=function(){return s},this.getCurrTarget=function(){return g.getStepTarget(E())},this.getCurrStepNum=function(){return t},this.getSkippedStepsIndexes=function(){var a,b=[];for(a in z)b.push(a);return b},this.refreshBubblePosition=function(){var a=E();return a&&B().setPosition(a),this.getCalloutManager().refreshCalloutPositions(),this},this.listen=function(a,b,c){return a&&h[a].push({cb:b,fromTour:c}),this},this.unlisten=function(a,b){var c,d,e=h[a];for(c=0,d=e.length;d>c;++c)e[c].cb===b&&e.splice(c,1);return this},this.removeCallbacks=function(a,b){var c,d,e,f;for(f in h)if(!a||a===f)if(b)for(c=h[f],d=0,e=c.length;e>d;++d)c[d].fromTour&&(c.splice(d--,1),--e);else h[f]=[];return this},this.registerHelper=function(a,b){"string"==typeof a&&"function"==typeof b&&(i[a]=b)},this.unregisterHelper=function(a){i[a]=null},this.invokeHelper=function(a){var b,c,d=[];for(b=1,c=arguments.length;c>b;++b)d.push(arguments[b]);i[a]&&i[a].call(null,d)},this.setCookieName=function(a){return o.cookieName=a,this},this.resetDefaultOptions=function(){return o={},this},this.resetDefaultI18N=function(){return e={},this},this.getState=function(){return g.getState(D("cookieName"))},x=function(a,b){var c,d,f,h,i=["next","prev","start","end","show","error","close"];for(o||this.resetDefaultOptions(),g.extend(o,a),a&&g.extend(e,a.i18n),f=0,h=i.length;h>f;++f)d="on"+i[f].charAt(0).toUpperCase()+i[f].substring(1),a[d]&&this.listen(i[f],a[d],b);return c=B(!0),this},this.configure=function(a){return x.call(this,a,!1)},this.setRenderer=function(a){var b="undefined"==typeof a?"undefined":m(a);return"string"===b?(n=a,f=void 0):"function"===b&&(f=a),this},this.setEscaper=function(a){return this},N.call(this,a)},l=new a,function(){var a={};a.escape=function(a){return customEscape?customEscape(a):null==a?"":(""+a).replace(new RegExp("[&<>\"']","g"),function(a){return"&"==a?"&amp;":"<"==a?"&lt;":">"==a?"&gt;":'"'==a?"&quot;":"'"==a?"&#x27;":void 0})},this.templates=this.templates||{},this.templates.bubble_default=function(b){function c(b,c){return c?a.escape(b):b}var d,e="";a.escape,Array.prototype.join;e+="\n";var f=b.i18n,g=b.buttons,h=b.step,i=b.tour;return e+='\n<div class="hopscotch-bubble-container" style="width: '+(null==(d=h.width)?"":d)+"px; padding: "+(null==(d=h.padding)?"":d)+'px;">\n  ',i.isTour&&(e+='<span class="hopscotch-bubble-number">'+(null==(d=f.stepNum)?"":d)+"</span>"),e+='\n  <div class="hopscotch-bubble-content">\n    ',""!==h.title&&(e+='<h3 class="hopscotch-title">'+(null==(d=c(h.title,i.unsafe))?"":d)+"</h3>"),e+="\n    ",""!==h.content&&(e+='<div class="hopscotch-content">'+(null==(d=c(h.content,i.unsafe))?"":d)+"</div>"),e+='\n  </div>\n  <div class="hopscotch-actions">\n    ',g.showPrev&&(e+='<button class="hopscotch-nav-button prev hopscotch-prev">'+(null==(d=f.prevBtn)?"":d)+"</button>"),e+="\n    ",g.showCTA&&(e+='<button class="hopscotch-nav-button next hopscotch-cta">'+(null==(d=g.ctaLabel)?"":d)+"</button>"),e+="\n    ",g.showNext&&(e+='<button class="hopscotch-nav-button next hopscotch-next">'+(null==(d=f.nextBtn)?"":d)+"</button>"),e+="\n  </div>\n  ",g.showClose&&(e+='<button class="hopscotch-bubble-close hopscotch-close">'+(null==(d=f.closeTooltip)?"":d)+"</button>"),e+='\n</div>\n<div class="hopscotch-bubble-arrow-container hopscotch-arrow">\n  <div class="hopscotch-bubble-arrow-border"></div>\n  <div class="hopscotch-bubble-arrow"></div>\n</div>\n'}}.call(l);var x=l;return x});